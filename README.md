# –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã

Systemd - —Å–æ–∑–¥–∞–Ω–∏–µ unit-—Ñ–∞–π–ª–∞

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã](#–∑–∞–≥—Ä—É–∑–∫–∞-—Å–∏—Å—Ç–µ–º—ã)
  - [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](#—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)
  - [–¶–µ–ª—å](#—Ü–µ–ª—å)
  - [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-–¥–æ–º–∞—à–Ω–µ–≥–æ-–∑–∞–¥–∞–Ω–∏—è)
    - [–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å](#—á—Ç–æ-–Ω—É–∂–Ω–æ-—Å–¥–µ–ª–∞—Ç—å)
  - [–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑](#–±–∞–∑–æ–≤—ã–π-–æ–±—Ä–∞–∑)
  - [–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ª–æ–≥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–∞-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞-–ª–æ–≥–∞-–Ω–∞-–ø—Ä–µ–¥–º–µ—Ç-–Ω–∞–ª–∏—á–∏—è-–∫–ª—é—á–µ–≤–æ–≥–æ-—Å–ª–æ–≤–∞)
  - [–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `spawn-fcgi` –∏ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª `spawn-fcgi.service` —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–¥–µ–ª–∫–∏ init-—Å–∫—Ä–∏–ø—Ç–∞](#—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å-spawn-fcgi-–∏-—Å–æ–∑–¥–∞—Ç—å-unit-—Ñ–∞–π–ª-spawn-fcgiservice-—Å-–ø–æ–º–æ—â—å—é-–ø–µ—Ä–µ–¥–µ–ª–∫–∏-init-—Å–∫—Ä–∏–ø—Ç–∞)
  - [–ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ Nginx](#–∑–∞–ø—É—Å–∫-–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö-–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤-—Å–µ—Ä–≤–µ—Ä–∞-nginx)

## –¶–µ–ª—å

- –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ unit-—Ñ–∞–π–ª—ã

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. –ù–∞–ø–∏—Å–∞—Ç—å service, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (—Ñ–∞–π–ª –ª–æ–≥–∞ –∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤ `/etc/default`)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `spawn-fcgi` –∏ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª (`spawn-fcgi.service`) —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–¥–µ–ª–∫–∏ init-—Å–∫—Ä–∏–ø—Ç–∞ [https://gist.github.com/cea2k/1318020](https://gist.github.com/cea2k/1318020)
3. –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å unit-—Ñ–∞–π–ª `Nginx` (nginx.service) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑

–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ `Ubuntu 24.04.3 LTS`.

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
ubuntu@ubuntu:~$ sudo -i
root@ubuntu:~# uname --all
Linux ubuntu 6.8.0-100-generic #100-Ubuntu SMP PREEMPT_DYNAMIC Tue Jan 13 16:40:06 UTC 2026 x86_64 x86_64 x86_64 GNU/Linux
root@ubuntu:~# cat /etc/os-release
PRETTY_NAME="Ubuntu 24.04.3 LTS"
NAME="Ubuntu"
VERSION_ID="24.04"
VERSION="24.04.3 LTS (Noble Numbat)"
VERSION_CODENAME=noble
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=noble
LOGO=ubuntu-logo
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞...</summary>
<img src="screenshots/base_image.png" alt="Base image">
</details>

</td></tr>
</table>

## –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ª–æ–≥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞

–ó–∞–¥–∞—á—É –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏:

- —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞, –≥–¥–µ –±—É–¥–µ–º –∏—Å–∫–∞—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `/var/log/watchlog.log`
- —Å–æ–∑–¥–∞–Ω–∏–µ bash-—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `/opt/watchlog.sh`
- —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `/etc/default/watchlog.conf`, –≥–¥–µ –æ–ø—Ä–µ–¥–µ–ª–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞
- —Å–æ–∑–¥–∞–Ω–∏–µ unit-—Ñ–∞–π–ª–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ `/etc/systemd/system/watchlog.service`
- —Å–æ–∑–¥–∞–Ω–∏–µ unit-—Ñ–∞–π–ª–∞ —Ç–∞–π–º–µ—Ä–∞ `/etc/systemd/system/watchlog.timer` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ `watchlog.service`

–î–ª—è —Å–µ–±—è –∏–º–µ–µ–º –≤–≤–∏–¥—É, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ–º –∏–∑-–ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `root`, –∏–Ω–∞—á–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—É –∫–æ–¥ –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Ñ–∞–π–ª–æ–≤:

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

<details>
<summary>/var/log/watchlog.log</summary>

```text
# Text file for test watchlog-service
08.02.2026 10:00: Initial exec...
08.02.2026 10:01: ALERT: Some alert text
08.02.2026 10:02: Message...
```

</details>

<details>
<summary>/opt/watchlog.sh</summary>

```bash
#!/usr/bin/env bash

set -euo pipefail

function dt_log {
  local __MSG="$(date +'%d.%m.%Y %H:%M:%S %Z(UTC%z)'): $1"
  echo "${__MSG}"
  ## Add message also to `/var/log/syslog`
  logger "${__MSG}"
}

# -------------------------------------------------
WORD=$1
LOG=$2

if grep -i "${WORD}" "${LOG}" &> /dev/null; then
  dt_log "I found word ${WORD} in file ${LOG}!"
else
  exit 0
fi
```

</details>

<details>
<summary>/etc/default/watchlog.conf</summary>

```ini
# Configuration file `watchlog.conf` for watchlog-service
# Place it to /etc/default

# File and word in that file that we will be monit
WORD="ALERT"
LOG="/var/log/watchlog.log"
```

</details>

<details>
<summary>/etc/systemd/system/watchlog.service</summary>

```ini
[Unit]
Description=My watchlog service

[Service]
Type=oneshot
EnvironmentFile=/etc/default/watchlog.conf
ExecStart=/opt/watchlog.sh "${WORD}" "${LOG}"
RemainAfterExit=no
```

</details>

<details>
<summary>/etc/systemd/system/watchlog.timer</summary>

```ini
[Unit]
Description=Run watchlog script every 30 second

[Timer]
# Run every 30 second
OnActiveSec=30
OnUnitActiveSec=30
Unit=watchlog.service
Persistent=true

[Install]
WantedBy=timers.target
```

</details>

</td></tr>
</table>

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ–≥–æ —Ä–∞–±–æ—Ç—ã

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo systemctl daemon-reload
sudo systemctl start watchlog.timer
sudo systemctl status watchlog.timer
sudo journalctl -u watchlog.service | tail -n 20
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞...</summary>
<img src="screenshots/watchlog1.png" alt="Start service">
<img src="screenshots/watchlog2.png" alt="Check service files">
<img src="screenshots/watchlog3.png" alt="Check journal">
</details>

</td></tr>
</table>

## –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `spawn-fcgi` –∏ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª `spawn-fcgi.service` —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–¥–µ–ª–∫–∏ init-—Å–∫—Ä–∏–ø—Ç–∞

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `spawn-fcgi` –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –Ω–µ–≥–æ –ø–∞–∫–µ—Ç—ã

```bash
sudo apt-get update && sudo apt-get install -y spawn-fcgi php php-cgi php-cli apache2 libapache2-mod-fcgid fcgiwrap
```

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –≤ —Ñ–∞–π–ª–µ `/etc/spawn-fcgi/fcgi.conf`

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo mkdir -p /etc/spawn-fcgi

sudo tee > /etc/spawn-fcgi/fcgi.conf <<EOF
SOCKET=/var/run/php-fcgi.sock
PIDFile=/run/spawn-fcgi.pid
OPTIONS="-u www-data -g www-data -s  -S -M 0600 -C 32 -F 1 -- /usr/bin/php-cgi"
EOF

sudo tee > /etc/systemd/system/spawn-fcgi.service <<EOF
[Unit]
Description=Spawn-fcgi startup service by Otus
After=network.target

[Service]
Type=simple
PIDFile=$PIDFile
EnvironmentFile=/etc/spawn-fcgi/fcgi.conf

ExecStart=/usr/bin/spawn-fcgi -n $OPTIONS
ExecStop=/bin/kill -TERM $MAINPID
ExecStopPost=/bin/rm -f $PIDFile

# Kill child processes
KillMode=control-group
TimeoutStopSec=10

Restart=on-failure
RestartSec=3s

[Install]
WantedBy=multi-user.target
EOF
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞...</summary>
<img src="screenshots/spawn-fcgi.png" alt="Prepare script config and unit-file">
</details>

</td></tr>
</table>

–ü–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo systemctl daemon-reload
sudo systemctl start spawn-fcgi
sudo systemctl status spawn-fcgi

sudo systemctl stop spawn-fcgi
sudo systemctl status spawn-fcgi

sudo systemctl start spawn-fcgi
sudo systemctl restart spawn-fcgi
sudo systemctl status spawn-fcgi
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞...</summary>
<img src="screenshots/spawn-fcgi-check1.png" alt="Check 1">
<img src="screenshots/spawn-fcgi-check2.png" alt="Check 2">
<img src="screenshots/spawn-fcgi-check3.png" alt="Check 3">
</details>

</td></tr>
</table>

## –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ Nginx

–£—Å—Ç–∞–Ω–æ–≤–∏–º Nginx –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
sudo apt-get update && sudo apt-get install -y nginx
```

–°–∫–æ–ø–∏—Ä—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π unit-—Ñ–∞–π–ª –≤ —Ñ–∞–π–ª `nginx.service.orig` –¥–ª—è –±—ç–∫–∞–ø–∞:

```bash
mv /usr/lib/systemd/system/nginx.service{,.orig}
```

–ü–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤:

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo tee > /usr/lib/systemd/system/nginx-first.service <<EOF
[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target
ConditionFileIsExecutable=/usr/sbin/nginx

[Service]
Type=forking
PIDFile=/run/nginx-first.pid
ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx-first.conf -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx-first.conf -g 'daemon on; master_process on;'
ExecReload=/usr/sbin/nginx -c /etc/nginx/nginx-first.conf -g 'daemon on; master_process on;' -s reload
ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx-first.pid
TimeoutStopSec=5
KillMode=mixed

[Install]
WantedBy=multi-user.target
EOF

sudo tee > /usr/lib/systemd/system/nginx-second.service <<EOF
[Unit]
Description=A high performance web server and a reverse proxy server
Documentation=man:nginx(8)
After=network-online.target remote-fs.target nss-lookup.target
Wants=network-online.target
ConditionFileIsExecutable=/usr/sbin/nginx

[Service]
Type=forking
PIDFile=/run/nginx-second.pid
ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx-second.conf -q -g 'daemon on; master_process on;'
ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx-second.conf -g 'daemon on; master_process on;'
ExecReload=/usr/sbin/nginx -c /etc/nginx/nginx-second.conf -g 'daemon on; master_process on;' -s reload
ExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx-second.pid
TimeoutStopSec=5
KillMode=mixed

[Install]
WantedBy=multi-user.target
EOF
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞...</summary>
<img src="screenshots/nginx_prep1.png" alt="Unit-file first">
<img src="screenshots/nginx_prep2.png" alt="Unit-file second">
</details>

</td></tr>
</table>

–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫.
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –±—ç–∫–∞–ø–∏–º.

```bash
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx-first.conf
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx-second.conf
sudo mv /etc/nginx/nginx.conf{,.orig}
```

> –í–æ–æ–±—â–µ –¥–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø–ª–æ—Ö–æ–π, —Ç–∞–∫ –∫–∞–∫ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ø–æ –ø–æ—Ä—Ç–∞–º.
> –õ—É—á—à–µ –¥–ª—è —Ç–∞–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ docker, podman, kubernetes –∏ —Ç.–¥.

–ò–∑–º–µ–Ω–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤:

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo mkdir -p /etc/nginx/sites-available-first/
sudo mkdir -p /etc/nginx/sites-enabled-first/

sudo mkdir -p /etc/nginx/sites-available-second/
sudo mkdir -p /etc/nginx/sites-enabled-second/

sudo mkdir -p /etc/nginx/conf-first.d/
sudo mkdir -p /etc/nginx/conf-second.d/

# change configs
sed -e 's/pid \/run\/nginx.pid;/pid \/run\/nginx-first.pid;/g' -i /etc/nginx/nginx-first.conf
sed -e 's/pid \/run\/nginx.pid;/pid \/run\/nginx-second.pid;/g' -i /etc/nginx/nginx-second.conf

sed -e 's/include \/etc\/nginx\/conf.d\/\*.conf;/include \/etc\/nginx\/conf-first.d\/\*.conf;/g' -i /etc/nginx/nginx-first.conf 
sed -e 's/include \/etc\/nginx\/conf.d\/\*.conf;/include \/etc\/nginx\/conf-second.d\/\*.conf;/g' -i /etc/nginx/nginx-second.conf 

sed -e 's/include \/etc\/nginx\/sites-enabled\/\*;/include \/etc\/nginx\/sites-enabled-first\/\*;/g' -i /etc/nginx/nginx-first.conf 
sed -e 's/include \/etc\/nginx\/sites-enabled\/\*;/include \/etc\/nginx\/sites-enabled-second\/\*;/g' -i /etc/nginx/nginx-second.conf 
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞...</summary>
<img src="screenshots/nginx_prep3.png" alt="Prepare configs">
</details>

</td></tr>
</table>

–ü–æ–¥–≥–æ—Ç–∞–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤.

```bash
sudo tee > /etc/nginx/conf-first.d/site01.conf <<EOF
server {
  listen 9000 default_server;
  listen [::]:9000 default_server;

  root /var/www/html;
  index index.html index.htm index.nginx-debian.html;

  server_name _;

  location / {
    try_files $uri $uri/ =404;
  }
EOF

sudo tee > /etc/nginx/conf-second.d/site01.conf <<EOF
server {
  listen 9001 default_server;
  listen [::]:9001 default_server;

  root /var/www/html;
  index index.html index.htm index.nginx-debian.html;

  server_name _;

  location / {
    try_files $uri $uri/ =404;
  }
EOF
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–¥–∞...</summary>
<img src="screenshots/nginx_prep4.png" alt="Configs for sites">
</details>

</td></tr>
</table>

–°—Ç–∞—Ä—Ç—É–µ–º –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞:

<table>
<tr><td style="border: 1px solid #777; padding: 10px;">

```bash
sudo systemctl daemon-reload
sudo systemctl start nginx-first.service
sudo systemctl start nginx-second.service
sudo ss -tlpn | grep nginx
```

<details>
<summary>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–¥–∞...</summary>
<img src="screenshots/nginx-start-first.png" alt="Start first service">
<img src="screenshots/nginx-start-second.png" alt="Start second service">
<img src="screenshots/nginx-start-ports.png" alt="Check ports">
<img src="screenshots/nginx_curl.png" alt="Check access to NGINX">
</details>

</td></tr>
</table>
